<title>Tao Lin</title>
<style>
    :root {
        --grey0: black;
        --grey1: #1e1e1e;
        --grey2: #252526;
        --grey3: #333333;
        --grey4: #3c3c3c;
        --white0: white;
        --white1: #eeeeee;
        --white2: #d4d4d4;
        --white3: #cccccc;
        --white4: #858585;
        --blue: rgb(29, 56, 212);
        --purple: rgb(130, 21, 180);
    }

    body {
        background-color: var(--grey1);
        color: var(--white2);
        font-family: Verdana, Arial;
        margin: 0;
    }

    input {
        appearance: none;
        outline: none;
        border: none;
        box-shadow: none;
    }

    a {
        color: var(--blue);
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    a:visited {
        color: var(--purple);
    }

    #nav {
        background-color: var(--grey4);
        width: 100%;
        display: flex;
        justify-content: space-between;
    }

    #nav a {
        font-size: 36px;
        padding: 12px 16px;
        color: var(--white0);
        display: block;
    }

    #nav .right {
        display: flex;
    }

    #nav .right a {
        font-size: 20px;
        margin-top: 8px;
    }

    #main {
        margin: 10px 20px;
    }

    #footer-links a {
        display: block;
    }

    footer {
        background-color: var(--grey2);
        border: 2px solid var(--grey4);
        border-width: 1px 0 0 0;
        padding: 40px 0 40px 40px;
        margin: 40px 0 0 0;
    }

    #spreadsheet-cells {
        max-height: 800px;
        max-width: 100%;
        overflow-x: scroll;
        overflow-y: scroll;
    }

    #spreadsheet-cells div {
        display: flex;
    }

    #spreadsheet-cells div div {
        width: 50px;
        max-width: 50px;
        height: 20px;
        background-color: var(--grey3);
        border: 1px solid var(--grey4);
    }

    #spreadsheet-input {
        border-radius: 0px;
        margin: 0;
        padding: 0px;
        max-width: 60px;
    }

    ::-webkit-scrollbar {
        width: 10px;
    }

    ::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
        background: #888;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
<div id="nav">
    <a id="home">Tao Roa Lin</a>
    <div class="right">
        <a href="/about">About</a><a href="/blog">Blog</a> <a href="https://boiling-peak-00646.herokuapp.com/">Web
            Dev
            Demo</a><a>Settings</a>
    </div>
</div>
<div id="main">
    <p>JK, there's just dark mode :)</p>
    <h1>Tao Lin's Website</h1>
    <p>I am interested in virtual reality, programming languages, functional programming, artificial
        intelligence, AI existential risk, rationality, and effective altruism.</p>
    <p>I program in Clojure, JavaScript, C#, and C++. I'm currently working on a VR tool for working
        inside network graphs.</p>
    <p>My favorite musician is <a href="https://open.spotify.com/artist/0xu4jAQQv7ZAqvFGdc9HgP?autoplay=true">Boy in
            Space</a>, my
        favorite shape is the <a href="https://en.wikipedia.org/wiki/Great_stellated_120-cell">Great Stellated
            120 Cell</a>, my favorite video game is <a
            href="https://store.steampowered.com/app/617830/SUPERHOT_VR/">Superhot VR</a></p>
    <p>This website is meant to test how performant a website can be if performance is truly the #1 priority</p>
    <div id="spreadsheet">
        <div id="spreadsheet-cells">

        </div>
    </div>
</div>
<footer>
    <div id="footer-links">
        <a href="https://twitter.com/taoroalin">twitter</a>
        <a href="https://github.com/taoroalin">github</a><a href="mailto:taoroalin@gmail.com">email</a>
        <a href="https://roamresearch.com/#/app/graphminer">personal notes</a>
    </div>
</footer>
<template id="template">
    <li id="theid" class="theclass theclass2"><a href="/broken/link">Broken link</a><a
            href="https://example.com">Working link</a><button style="color: red;">clickable</button></li>
</template>
<div id="templateRoot"></div>
<div id="testDomRoot"></div>
<div id="treeTest"></div>
<script type="text/javascript"> // TODO minify-html isn't correctly minifying js
    const timeFunc = (f, n, ...args) => {
        const stime = performance.now();
        f.apply({}, args);
        console.log(`Function ${n} took ${performance.now() - stime}`)
    }

    const ExpTypes = Object.freeze({ NUMBER: 0, OOA: 1, OP: 2, REF: 3, ATOMIC: 4 })
    const exampleParse = { type: ExpTypes.OOA, order: 0, op: "+", children: [{ type: ExpTypes.NUMBER, number: 1 }, { type: ExpTypes.NUMBER, number: 2 }] }
    const parseExpression = (raw) => {
        let parenLevel = 0;
        const result = {};
        const lastType = null;
        let i = 0; // current char
        while (i < raw.length) {
            const char = raw[i];
            if (char === "+") {

            }
        }
        return result;
    }


    const pureWordRx = /[a-zA-Z]+/;
    const pureTextRx = /[a-zA-Z0-9\,\.\?\\\/ ]+/;
    const parseRoam = (raw) => {
        const result = {};
        const stack = [result];
        let i = 0;
        while (i < raw.length) {
            if (raw) {

            }

        }
    }


    const cols = 26, rows = 100;
    let focusedCell = null;
    let spreadsheet, input;
    const initSheet = () => {
        spreadsheet = document.getElementById("spreadsheet-cells");
        for (let r = 0; r < rows; r++) {
            const row = document.createElement("div");
            row.row = r;
            for (let c = 0; c < cols; c++) {
                const cell = document.createElement("div");
                cell.col = c;
                //cell.raw=undefined
                row.appendChild(cell)
            }
            spreadsheet.appendChild(row);
        }

        input = document.createElement("input");
        input.id = "spreadsheet-input";
        input.addEventListener('mousedown', (e) => {
            e.stopPropagation();
        });

        spreadsheet.addEventListener('mousedown', (event) => {
            focusCell(event.target.parentElement.row, event.target.col);
        })

        input.addEventListener('keydown', (event) => {
            switch (event.key) {
                case "Enter":
                case "ArrowDown":
                    if (focusedCell.row < rows - 1) {
                        if (event.key == "Enter" && event.shiftKey) {
                            focusCell(focusedCell.row - 1, focusedCell.col);
                        } else {
                            focusCell(focusedCell.row + 1, focusedCell.col);
                        }
                    }
                    break;
                case "Tab":
                    if (focusedCell.col < cols - 1) {
                        event.preventDefault();
                        if (event.shiftKey) {
                            focusCell(focusedCell.row, focusedCell.col - 1);
                        } else {
                            focusCell(focusedCell.row, focusedCell.col + 1);
                        }
                    }
                case "ArrowRight":
                    if (focusedCell.col < cols - 1 && event.target.selectionStart >= event.target.value.length) {
                        focusCell(focusedCell.row, focusedCell.col + 1);
                    }
                    break;
                case "ArrowLeft":
                    if (focusedCell.col > 0 && event.target.selectionStart == 0) {
                        focusCell(focusedCell.row, focusedCell.col - 1);
                    }
                    break;
                case "ArrowUp":
                    if (focusedCell.row > 0) {
                        focusCell(focusedCell.row - 1, focusedCell.col);
                    }
                    break;
            }

        });

        const pasteCSV = (raw) => {
            const rowsText = raw.split("\n");
            const r0 = focusedCell.row, c0 = focusedCell.col;
            const rowDivs = spreadsheet.children;
            for (let r = 0; r < rowsText.length && r0 + r < rows; r++) {
                const colDivs = rowDivs[r0 + r].children;
                const colsText = rowsText[r].split(",");
                for (let c = 0; c < colsText.length && c0 + c < cols; c++) {
                    colDivs[c0 + c].innerText = colsText[c];
                }
            }
        }

        input.addEventListener('paste', (event) => { // paste csv into cells
            event.preventDefault();
            timeFunc(pasteCSV, "pasteCSV", event.clipboardData.getData("text"))
        });
    }
    const getCell = (r, c) => spreadsheet.children[r].children[c];

    const focusCell = (row, col) => {
        focusedCell = { row, col }
        getCell(row, col).appendChild(input);
        setTimeout(() => input.focus(), 0); // todo make this faster
    }

    //timeFunc(initSheet, "initSheet");

    const testTemplatePlain = () => {
        const template = document.getElementById("template");
        const root = document.getElementById("templateRoot");
        for (let i = 0; i < 1000; i++) {
            const clon = template.content.cloneNode(true);
            root.appendChild(clon);
        }
    }
    const testTemplate = () => {
        const template = document.getElementById("template").content;
        const root = document.getElementById("templateRoot");
        for (let i = 0; i < 1000; i++) {
            const clon = template.cloneNode(true);
            clon.querySelector("a").style.color = "pink";
            clon.querySelector("button").innerText = "asdfasdfasfnabnnng s sfah fasd afsd";
            root.appendChild(clon);
        }
    }
    //timeFunc(testTemplate, "template");

    const testDom = () => {
        const testDomRoot = document.getElementById("testDomRoot");
        for (let i = 0; i < 1000; i++) {

            const li = document.createElement("li");
            li.id = "theid";
            li.className = "theclass theclass2";
            const a1 = document.createElement('a');
            a1.href = "/broken/link";
            a1.innerText = "Broken Link";
            const a2 = document.createElement('a');
            a2.href = "https://example.com";
            a2.innerText = "Working link"
            const b1 = document.createElement('button');
            b1.onclick = () => console.log("clicked");
            b1.style.color = "red";
            b1.innerText = "hello";
            li.appendChild(a1);
            li.appendChild(a2);
            li.appendChild(b1);
            testDomRoot.appendChild(li);
        }
    }
    //timeFunc(testDom, "Dom");


    // hot reloading for development :)
    window.addEventListener('focus', () => location.reload());
    // look at how much simpler this is than express server!!!!
</script>

<template id="page-link-template">
    <span class="roam-page-link"><span>[[</span><a class="slot"></a><span>]]</span></span>
</template>
<template id="bold-template">
    <span class="roam-bold slot"></span>
</template>
<template id="text-template">
    <span class="roam-text slot"></span>
</template>

<script>
    const renderers = {
        "page-link": (nodeData, children) => {
            const node = document.getElementById("page-link-template").content.cloneNode(true);
            const slot = node.querySelector(".slot");
            if (slot !== undefined) {
                children.forEach(element => slot.appendChild(element));
            }
            return node;
        },
        "text": (nodeData, children) => {
            const node = document.getElementById("text-template").content.cloneNode(true);
            const slot = node.querySelector(".slot");
            if (slot !== undefined) {
                children.forEach(element => slot.appendChild(element));
            }
            return node;
        },
        "bold": (nodeData, children) => {
            const node = document.getElementById("bold-template").content.cloneNode(true);
            const slot = node.querySelector(".slot");
            slot.style.color = "pink";
            if (slot !== undefined) {
                children.forEach(element => slot.appendChild(element));
            }
            return node;
        }
    }
    const treeToDom = (tree) => {
        if (typeof (tree) === "string") {
            return document.createTextNode(tree);
        }
        return renderers[tree.type](tree.nodeData, tree.children.map(treeToDom));
    }

    const exampleTree = { type: "text", children: [...Array(1000)].map(() => ({ type: "bold", children: [{ type: "page-link", children: ["linkeydinkey!"] }, "hello!", { type: "bold", children: [{ type: "page-link", children: ["hiho", "wheeee"] }] }] })) }
    const testTreeToDom = () => {
        document.getElementById("treeTest").appendChild(treeToDom(exampleTree));
    }

    timeFunc(testTreeToDom, "tree to dom")
</script>