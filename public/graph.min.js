let subGraphs,canvas,ctx,nodes=[],edges=[],mousePosition={x:0,y:0,prevX:0,prevY:0},updating=!0,canvasInnerWidth=936,canvasInnerHeight=969,canvasOffsetX=0,canvasOffsetY=0;const attraction=.007,friction=.8,epsilon=1e-4,repulsion=1e-7,zoomRatioPerMouseWheelTick=.15,canvasWidth=936,canvasHeight=969,twoPI=2*Math.PI,zed=()=>({x:1}),newNode=e=>({x:0,y:0,dx:0,dy:0,title:e,numConnections:0});var loadRoamJSONGraph=e=>{const n={};e.forEach((e,t)=>n[e.title]=t),nodes=e.map(e=>newNode(e.title)),edges=[];const t={},o=(e,s)=>{if(void 0!==s.string){const o=o=>{const s=n[o[1]];if(void 0!==s){const n=e+1e6*s;void 0===t[n]&&(t[n]=!0,nodes[e].numConnections+=1,nodes[s].numConnections+=1,edges.push([nodes[e],nodes[s]]))}},a=[/\#([a-zA-Z]+)/g,/\[\[([^\]]+)\]\]/g,/^([a-zA-Z ]+)::/g];a.forEach(e=>{const n=s.string.matchAll(e);for(let e of n)o(e)})}void 0!==s.children&&s.children.forEach(n=>o(e,n))};e.forEach(e=>{void 0!==e.children&&e.children.forEach(t=>o(n[e.title],t))}),nodes.forEach(e=>{const n=2/(1+e.numConnections);e.x=.5+(Math.random()-.5)*n,e.y=.5+(Math.random()-.5)*n})},initGraph=async()=>{canvas=document.getElementById("graph-canvas"),ctx=canvas.getContext("2d"),ctx.scale(canvas.width,canvas.height);const e=await fetch("graphminer.json").then(e=>e.json());loadRoamJSONGraph(e),canvas.addEventListener("mousemove",e=>{mousePosition.x=e.offsetX,mousePosition.y=e.offsetY}),canvas.addEventListener("mousedown",e=>{mousePosition.prevX=e.offsetX,mousePosition.prevY=e.offsetY});const n=e=>{mousePosition.prevX=0,mousePosition.prevY=0};canvas.addEventListener("mouseup",n),canvas.addEventListener("mouseleave",n),canvas.addEventListener("keypress",e=>{"Space"==e.code&&(updating=!updating,e.stopPropagation())}),canvas.addEventListener("wheel",e=>{const n=e.deltaY/100*zoomRatioPerMouseWheelTick,t=1/(1+n)-1,o=(mousePosition.x,mousePosition.y,canvasInnerHeight*(1+t)),s=canvasInnerWidth*(1+t);canvasOffsetX+=canvasWidth-canvasInnerWidth*(mousePosition.x/canvasWidth),canvasOffsetY+=canvasInnerHeight*(mousePosition.y/canvasHeight),canvasInnerWidth=s,canvasInnerHeight=o})},move=()=>{edges.forEach(([e,n])=>{const t=(e.x-n.x)*attraction,o=(e.y-n.y)*attraction;e.dx-=t,n.dx+=t,e.dy-=o,n.dy+=o}),nodes.forEach(e=>nodes.forEach(n=>{const t=Math.abs((e.x-n.x)*(e.x-n.x)*(e.x-n.x))+Math.abs((e.y-n.y)*(e.y-n.y)*(e.y-n.y))+epsilon,o=(e.x-n.x)/t*repulsion,s=(e.y-n.y)/t*repulsion;e.dx+=o,n.dx-=o,e.dy+=s,n.dy-=s})),nodes.forEach(e=>{e.x+=e.dx,e.y+=e.dy,e.dx*=friction,e.dy*=friction})},applyViewChanges=()=>{0!==mousePosition.prevX&&(canvasOffsetY+=mousePosition.y-mousePosition.prevY,canvasOffsetX+=mousePosition.x-mousePosition.prevX,mousePosition.prevX=mousePosition.x,mousePosition.prevY=mousePosition.y),ctx.setTransform(canvasInnerWidth,0,0,canvasInnerHeight,canvasOffsetX,canvasOffsetY)},render=()=>{ctx.save(),ctx.translate(-5e3,-5e3),ctx.clearRect(0,0,1e4,1e4),ctx.restore(),ctx.lineWidth=.002,edges.forEach(([e,n])=>{ctx.beginPath(),ctx.moveTo(e.x,e.y),ctx.lineTo(n.x,n.y),ctx.stroke()}),ctx.fillStyle="#555555",nodes.forEach(e=>{ctx.beginPath();const n=.007+1e-4*e.numConnections;ctx.arc(e.x,e.y,n,0,twoPI,!1),ctx.fill()}),ctx.fillStyle="#eeeeee",nodes.forEach(e=>{ctx.fillRect(e.x-.05,e.y,.1,.012)}),ctx.font="0.01px Verdana",ctx.fillStyle="#000000",nodes.forEach(e=>{ctx.fillText(e.title,e.x-.045,e.y+.01,20)})},update=()=>{updating&&move(),applyViewChanges(),render(),requestAnimationFrame(update)};profileNewTopLevelFunctions();var start=async()=>{await initGraph();for(let e=0;e<10;e++)move();requestAnimationFrame(update)};start();